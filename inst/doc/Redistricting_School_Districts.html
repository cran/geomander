<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />

<meta name="author" content="Christopher T Kenny" />


<title>Redistricting School Districts</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Redistricting School Districts</h1>
<h4 class="author">Christopher T Kenny</h4>



<p>The primary motivation behind this package is to make data
preparation steps easier for redistricting simulation methods within R.
This vignette covers a few key tasks, primarily building a block level
dataset of population data, subsetting by spatial relationship, and then
running a basic simulation. This is shown in the context of dividing
North Rockland Central School District in NY into 7 wards at the block
level.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(geomander)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(tinytiger)</span></code></pre></div>
<p>First, we want to build a block level dataset. The school district
intersects two counties, though almost all of the population in the
district comes from Rockland County. create_block_table allows you to
build block level datasets with the primary variables needed for
redistricting purposes - total population by race and voting age
population (VAP) by race.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>blockRockland <span class="ot">&lt;-</span> <span class="fu">create_block_table</span>(<span class="at">state =</span> <span class="st">&#39;NY&#39;</span>, <span class="at">county =</span> <span class="st">&#39;Rockland&#39;</span>)</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>blockOrange <span class="ot">&lt;-</span> <span class="fu">create_block_table</span>(<span class="at">state =</span> <span class="st">&#39;NY&#39;</span>, <span class="at">county =</span> <span class="st">&#39;Orange&#39;</span>)</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>block <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(blockRockland, blockOrange)</span></code></pre></div>
<p>For this vignette, rather than running the above, we use included
data. <code>orange</code> is a subset of Orange County which intersects
with the school district. Rockland is the entire block dataset. These
polygons are simplified using <code>rmapshaper</code> to make them
smaller.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;orange&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;rockland&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>block <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(rockland, orange)</span></code></pre></div>
<p>Next, we need the shape for North Rockland, which can be obtained
from the R package <code>tinytiger</code> as below. The same idea holds
for having target areas, such as counties or legislative districts,
though they are less likely to directly use the block level data.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>school <span class="ot">&lt;-</span> <span class="fu">tt_unified_school_districts</span>(<span class="at">state =</span> <span class="st">&#39;NY&#39;</span>) <span class="sc">|&gt;</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(NAME, <span class="st">&#39;North Rockland&#39;</span>))</span></code></pre></div>
<p>As above, we use a saved version that doesn’t need API access to
download.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;nrcsd&quot;</span>)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>school <span class="ot">&lt;-</span> nrcsd</span></code></pre></div>
<p>The immediate and common difficulty here is that we have nearly
15,000 blocks, but the target region, in this case the school district
outlined in red is significantly smaller than that.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>block <span class="sc">|&gt;</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> school, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&#39;red&#39;</span>) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="fu">theme_void</span>()</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- -->
As a first pass, we can use the geo_filter function, which wraps sf’s
st_intersects and filters only to those that intersect.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>block <span class="ot">&lt;-</span> block <span class="sc">|&gt;</span> <span class="fu">geo_filter</span>(<span class="at">to =</span> school)</span></code></pre></div>
<p>This drops us down to 852 block and is a conservative filtering, as
you only need to intersect at a single point.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>block <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> school, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&#39;red&#39;</span>) </span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- -->
Yet, we probably want to go further than that, getting rid of the
various external pieces. We can use geo_trim to do just that. First, we
want to check what would be thrown away at the default area threshold of
1%. Below, I’ve first checked what would be trimmed away, by setting
bool = TRUE and plotting it.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>block<span class="sc">$</span>trim <span class="ot">&lt;-</span> block <span class="sc">|&gt;</span> <span class="fu">geo_trim</span>(<span class="at">to =</span> school, <span class="at">bool =</span> <span class="cn">TRUE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>block <span class="sc">|&gt;</span> <span class="fu">ggplot</span>() <span class="sc">+</span> <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> trim)) <span class="sc">+</span> </span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> school, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.5</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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HrQsv6DKwnKTfv39JcJ4ql7fwxemOT9Rf/Q8P/XCSxYXJo1x9cBnbn7TJF94CSypjaLkyUfNr35XGtszqXH7oijZmgqMp17k1mCLD1q4WWymO3zdnlUUkFqeqbKw3KRf//vWjwrjO17VeKjR2r145MKPPPW+1R9fditvTT2ojf/44o0H3/n6oz95Liypjark/PJXp36TGv/+ru8c3PXJe1VJ7ht/OgXWYO9eXJ09KDZzlRIJVBSQXH1os7BczeT/RVSHW2Z/8b70ttvXz7dv+tvzftT++MWLvP35D2vjg7s+9fDPPnDoE15JbZQl984tf3oyLNngvvELr3ZrsOUHPXyXfOF7H1UQkHIgm4Xl6p30n3v+HF/99lX/+1Dq+en/0Nae1ss/eOaZT05v5mPGePeT3syPvOKXl3kltVGW3HvPzgul8dDMc/ivtqmSs77xnneDNdjyg9JIlG76qYKAZARyWVguASnjK69TxoXGQqP1tpedeMIbF/mZy+/Uxq+94Tr+z2d974leSW0UJQV5SX+hcfIZ9fe8WJaUcRwY73gvWIMtP4gvT/c3BBUFdER8G5eF5RKQb1yefGCude1Lv39l6vonrfHS99/K//20z17lldTGK83KatkwpX/OzzxblpQGYPzhIbAGWxlbex7oawgqCMgGROhBR2fvVulXZWzfuHux9fYbrvi6Wi+tjTe84C381OOu+IpXUhtFyRMXa99of/nyO03Jfz3mPmh8/K6jYA22/KD0G+3qawgqCMi6t7hDk3794945lX5VxqMHJtPtD7bOqfXSxih6ML/eGpTURlHyT/KCMD6lbkve4Rsn4Rrs9D8if16kr70g6kmjIkCICBAiAoSIACEiQIgIECIChIgAISJAiAgQIgKEiAAhIkCICBAiAoSIACEiQIgIECIChIgAISJAiAgQIgKEiAAhIkCICBAiAoSIACEiQIgIECIChIgAISJAiAgQIgKEiAAhIkCICBAiAoSIACEiQIgIECIChIgAISJAiAgQIgKEiAAhIkCICBAiAoSIACEiQIgIECIChIgAISJAiAgQIgKEiAAhIkCICBAiAoSIACEiQIgIECIChIgAISJAiP4PI31kChFLeyYAAAAASUVORK5CYII=" /><!-- --></p>
<p>To me, it looks like we are subsetting correctly with this threshold,
so we actually trim away this time.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>block <span class="ot">&lt;-</span> block <span class="sc">|&gt;</span> <span class="fu">filter</span>(trim)</span></code></pre></div>
<p>Very often, at this step, we want to consider including information
about other geographies, particularly towns, villages, or counties. In
the package, for illustration purposes, I’ve included a small towns
dataset from the <a href="https://www.rocklandgis.com/portal/apps/sites/#/data/items/746ec7870a0b4f46b168e07369e79a27">Rockland
County GIS Office</a>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;towns&quot;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>block <span class="sc">|&gt;</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">geom_sf</span>() <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> towns, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.character</span>(ID)))</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>From this, we can then try to match our blocks to towns. I use the
centroid option, which often works the most quickly. The default method,
‘center’ is slower, but more accurate.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>matched <span class="ot">&lt;-</span> <span class="fu">geo_match</span>(<span class="at">from =</span> block, <span class="at">to =</span> towns, <span class="at">method =</span> <span class="st">&#39;centroid&#39;</span>)</span></code></pre></div>
<p>Now, I’ve used the default tiebreaker setting, which assigns all
blocks to a town, even if they do not overlap.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>block <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">as.character</span>(matched))) <span class="sc">+</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">&#39;Match&#39;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- -->
So, we want to make two particular edits to the outcome. First, we
create a fake Orange County Town for the blocks that come from Orange
County, though there are only a few dozen people who live in those
blocks.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>block <span class="ot">&lt;-</span> block <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">TownID =</span> matched) <span class="sc">|&gt;</span> </span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">TownID =</span> <span class="fu">ifelse</span>(county <span class="sc">!=</span> <span class="st">&#39;087&#39;</span>, <span class="dv">8</span>, TownID)) </span></code></pre></div>
<p>Second, we can see that one block in 7 was matched to 1 because it
didn’t properly intersect the towns and thus went for the closest town
by distance between their centroids. A similar issue occured for two
other blocks.</p>
<p>Now, to figure out what’s going on and try to clean it up, we can
build an adjacency graph for each block by town and see which pieces are
discontinuous.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>adj <span class="ot">&lt;-</span> <span class="fu">adjacency</span>(<span class="at">shp =</span> block)</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">check_contiguity</span>(<span class="at">adj =</span> adj, <span class="at">group =</span> block<span class="sc">$</span>TownID)</span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="fu">which</span>(comp<span class="sc">$</span>component <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## [1] 576 586 591</code></pre>
<p>Then, using that information, we can figure out three of these need
to be renamed.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>block<span class="sc">$</span>TownID[<span class="dv">409</span>] <span class="ot">&lt;-</span> <span class="dv">7</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>block<span class="sc">$</span>TownID[<span class="dv">586</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>block<span class="sc">$</span>TownID[<span class="dv">591</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span></code></pre></div>
<p>Now all towns are completely connected or contiguous.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">check_contiguity</span>(<span class="at">adj =</span> adj, <span class="at">group =</span> block<span class="sc">$</span>TownID)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="fu">which</span>(comp<span class="sc">$</span>component <span class="sc">&gt;</span> <span class="dv">1</span>)</span></code></pre></div>
<pre><code>## integer(0)</code></pre>
<p>Finally, we have the data in a simulation-ready state! We can now use
the adjacency list created above with redist.adjacency to run a
simulation using redist.smc. See <a href="https://alarm-redist.org/">the
redist package</a> for more information about what’s going on here.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">library</span>(redist)</span></code></pre></div>
<pre><code>## Loading required package: redistmetrics</code></pre>
<pre><code>## 
## Attaching package: &#39;redistmetrics&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:dplyr&#39;:
## 
##     tally</code></pre>
<pre><code>## 
## Attaching package: &#39;redist&#39;</code></pre>
<pre><code>## The following object is masked from &#39;package:stats&#39;:
## 
##     filter</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>map <span class="ot">&lt;-</span> <span class="fu">redist_map</span>(block, <span class="at">pop_tol =</span> <span class="fl">0.02</span>, <span class="at">ndists =</span> <span class="dv">7</span>, <span class="at">adj =</span> adj)</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>sims005 <span class="ot">&lt;-</span> <span class="fu">redist_smc</span>(map, <span class="at">nsims =</span> <span class="dv">50</span>, <span class="at">counties =</span> TownID, <span class="at">silent =</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>plans <span class="ot">&lt;-</span> <span class="fu">get_plans_matrix</span>(sims005) <span class="sc">|&gt;</span> <span class="fu">unique</span>(<span class="at">MARGIN  =</span> <span class="dv">2</span>)</span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>par <span class="ot">&lt;-</span> <span class="fu">redist.parity</span>(<span class="at">plans =</span> plans, <span class="at">total_pop =</span> block<span class="sc">$</span>pop)</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>comp <span class="ot">&lt;-</span> <span class="fu">redist.compactness</span>(<span class="at">shp =</span> block, <span class="at">plans =</span> plans, <span class="at">adj =</span> adj, <span class="at">measure =</span> <span class="st">&#39;EdgesRemoved&#39;</span>)</span></code></pre></div>
<pre><code>## Warning in redist.compactness(shp = block, plans = plans, adj = adj, measure = &quot;EdgesRemoved&quot;): &#39;redist.compactness&#39; is deprecated.
## Use &#39;comp_edges_rem&#39; instead.
## See help(&quot;Deprecated&quot;)</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>comp_m <span class="ot">&lt;-</span> comp <span class="sc">|&gt;</span> <span class="fu">group_by</span>(draw) <span class="sc">|&gt;</span> <span class="fu">summarize</span>(<span class="at">mean =</span> <span class="fu">mean</span>(EdgesRemoved))</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>pick <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">parity =</span> par) <span class="sc">|&gt;</span> <span class="fu">bind_cols</span>(comp_m) <span class="sc">|&gt;</span> <span class="fu">slice_max</span>(<span class="at">order_by =</span> mean, <span class="at">n =</span> <span class="dv">1</span>) <span class="sc">|&gt;</span> <span class="fu">pull</span>(draw)</span></code></pre></div>
<p>In short, the above uses a Sequential Monte Carlo algorithm to draw
50 compact districts that try to preserve towns. From those, I pick a
map that is on average, pretty compact. You would typically aim for
about 100 times this number of simulations to start. This is shortened
for vignette compilation time.</p>
<p>Then we have the basic information we want and we can look at the VAP
data to see that we have one majority minority Hispanic ward and one
potential coalition ward.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>block <span class="sc">|&gt;</span> </span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> plans[,pick]) <span class="sc">|&gt;</span> </span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="fu">group_by</span>(district) <span class="sc">|&gt;</span> </span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">&#39;vap&#39;</span>), sum))</span></code></pre></div>
<pre><code>## Simple feature collection with 7 features and 10 fields
## Geometry type: POLYGON
## Dimension:     XY
## Bounding box:  xmin: -8250400 ymin: 5038222 xmax: -8228926 ymax: 5061114
## Projected CRS: WGS 84 / Pseudo-Mercator
## # A tibble: 7 × 11
##   district   vap vap_white vap_black vap_hisp vap_aian vap_asian vap_nhpi
##      &lt;int&gt; &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
## 1        1  5334      4353       167      582       11       177        1
## 2        2  5317      4457       170      535        2       105        0
## 3        3  4879       954       471     3295       10       106        0
## 4        4  5188      2133       387     2475        7       117        2
## 5        5  5168      1842       955     1991        6       283        2
## 6        6  5439      3382       740      959        3       286        0
## 7        7  5135      3309       376     1195        7       196        0
## # ℹ 3 more variables: vap_other &lt;dbl&gt;, vap_two &lt;dbl&gt;, geometry &lt;POLYGON [m]&gt;</code></pre>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
